# çº¦å‘ YueFa MVP ç³»ç»Ÿæ¶æ„ä¸å¼€å‘è®¡åˆ’

> **ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2026-01-20
> **å¯¹åº”PRD**: äº§å“éœ€æ±‚æ–‡æ¡£ PRD 2.0 æµç¨‹æ·±åº¦æ•´åˆç‰ˆ

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
çº¦å‘(YueFa)æ˜¯ä¸€æ¬¾é¢å‘Cosplayå‡å‘é€ å‹å¸ˆ(æ¯›å¨˜)çš„ç§»åŠ¨ç«¯H5å·¥å…·å¹³å°ï¼Œå¸®åŠ©æ¯›å¨˜å±•ç¤ºä½œå“é›†ã€æ”¶é›†å®¢æˆ·è¯¢ä»·ã€ç®¡ç†è®¢å•å…¨æµç¨‹ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼ 
- **è¿˜åŸçœŸå®æ¥å•é“¾è·¯**ï¼šæŠŠæ§å®šé‡‘ã€æ¯›å¯ã€éªŒæ”¶ç­‰å…³é”®èŠ‚ç‚¹é£é™©
- **æ·±åˆ»ç†è§£è¡Œä¸šç—›ç‚¹**ï¼šè§£å†³"å®šé‡‘ä»˜äº†ä½†æ¯›å¯æ²¡å¯„æ¥"ã€"éªŒæ”¶æ²¡é—­ç¯"ç­‰é—®é¢˜
- **æ•°å­—åŒ–è®¢å•ç®¡ç†**ï¼šä»è¯¢ä»·åˆ°äº¤ä»˜çš„å…¨é“¾è·¯è¿½è¸ª

### 1.3 ç›®æ ‡ç”¨æˆ·
- **æ¯›å¨˜(é€ å‹å¸ˆ)**ï¼šç®¡ç†è®¢å•ã€å±•ç¤ºä½œå“ã€æ¥æ”¶è¯¢ä»·
- **å®¢æˆ·(Coser)**ï¼šæµè§ˆä½œå“ã€æäº¤å®šåˆ¶éœ€æ±‚ã€å‚ä¸éªŒæ”¶

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æˆ·ç«¯å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     å®¢æˆ·ç«¯ H5        â”‚          æ¯›å¨˜ç®¡ç†ç«¯ H5              â”‚
â”‚  (å…¬å¼€ä¸»é¡µ/éªŒæ”¶é¡µ)    â”‚    (ç™»å½•/ä½œå“/è®¢å•/ä¸ªäººä¸­å¿ƒ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Express.js API Server                    â”‚
â”‚     /api/v1/auth  /api/v1/orders  /api/v1/reviews ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    PostgreSQL        â”‚              å¯¹è±¡å­˜å‚¨               â”‚
â”‚    (ç”Ÿäº§ç¯å¢ƒ)         â”‚         (å›¾ç‰‡/æ–‡ä»¶ä¸Šä¼ )             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚
â”‚    SQLite/sql.js     â”‚                                     â”‚
â”‚    (æµ‹è¯•ç¯å¢ƒ)         â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vue.js | 3.5.x | æ ¸å¿ƒæ¡†æ¶ |
| Vite | 5.x | æ„å»ºå·¥å…· |
| Vant | 4.x | ç§»åŠ¨ç«¯UIç»„ä»¶åº“ |
| Pinia | 2.x | çŠ¶æ€ç®¡ç† |
| Vue Router | 4.x | è·¯ç”±ç®¡ç† |
| Tailwind CSS | 3.x | åŸå­åŒ–CSS |
| Axios | 1.x | HTTPå®¢æˆ·ç«¯ |

### 2.3 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Node.js | 18+ | è¿è¡Œæ—¶ |
| Express.js | 4.x | Webæ¡†æ¶ |
| PostgreSQL | 15+ | ç”Ÿäº§æ•°æ®åº“ |
| sql.js | 1.x | æµ‹è¯•æ•°æ®åº“ (SQLite) |
| JWT | - | èº«ä»½è®¤è¯ |
| bcryptjs | 2.x | å¯†ç åŠ å¯† |
| express-validator | 7.x | è¯·æ±‚éªŒè¯ |
| multer | 1.x | æ–‡ä»¶ä¸Šä¼  |

### 2.4 å¼€å‘ä¸éƒ¨ç½²

| å·¥å…· | ç”¨é€” |
|------|------|
| pnpm | åŒ…ç®¡ç†(Monorepo) |
| Vitest | å•å…ƒæµ‹è¯• |
| Supertest | APIæµ‹è¯• |
| Playwright | E2Eæµ‹è¯• |
| Docker | å®¹å™¨åŒ–éƒ¨ç½² |
| Nginx | åå‘ä»£ç† |

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 ERå›¾æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚       â”‚   orders    â”‚       â”‚   reviews   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ user_id     â”‚       â”‚ id (PK)     â”‚
â”‚ phone       â”‚       â”‚ id (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ order_id    â”‚
â”‚ nickname    â”‚       â”‚ status      â”‚       â”‚ images      â”‚
â”‚ slug        â”‚       â”‚ wig_source  â”‚       â”‚ is_approved â”‚
â”‚ ...         â”‚       â”‚ ...         â”‚       â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚
       â–¼                     â”‚                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    works    â”‚              â”‚              â”‚  revisions  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚              â”‚              â”‚ id (PK)     â”‚
â”‚ user_id     â”‚              â”‚              â”‚ review_id   â”‚
â”‚ image_url   â”‚              â”‚              â”‚ request     â”‚
â”‚ ...         â”‚              â”‚              â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  inquiries  â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ id (PK)     â”‚
                      â”‚ user_id     â”‚
                      â”‚ wig_source  â”‚
                      â”‚ ...         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®è¡¨å®šä¹‰

#### 3.2.1 users è¡¨ (ç”¨æˆ·/æ¯›å¨˜)

```sql
CREATE TABLE users (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    phone           VARCHAR(20) NOT NULL UNIQUE,
    nickname        VARCHAR(50),
    avatar_url      TEXT,
    wechat_id       VARCHAR(50),
    announcement    TEXT,
    slug            VARCHAR(50) UNIQUE,
    status          SMALLINT DEFAULT 1,  -- 1:æ­£å¸¸ 0:ç¦ç”¨
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_users_slug ON users(slug);
```

#### 3.2.2 works è¡¨ (ä½œå“é›†)

```sql
CREATE TABLE works (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id         UUID NOT NULL REFERENCES users(id),
    image_url       TEXT NOT NULL,
    thumbnail_url   TEXT,
    title           VARCHAR(100),
    character_name  VARCHAR(50),
    source_work     VARCHAR(100),
    tags            TEXT,  -- JSONæ•°ç»„
    sort_order      INTEGER DEFAULT 0,
    status          SMALLINT DEFAULT 1,
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_works_user_id ON works(user_id);
```

#### 3.2.3 inquiries è¡¨ (è¯¢ä»·å•) - **PRD 2.0 å‡çº§**

```sql
CREATE TABLE inquiries (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id             UUID NOT NULL REFERENCES users(id),

    -- å®¢æˆ·ä¿¡æ¯
    customer_name       VARCHAR(50),
    customer_contact    VARCHAR(100),

    -- è§’è‰²ä¿¡æ¯
    character_name      VARCHAR(100) NOT NULL,
    source_work         VARCHAR(100),
    reference_images    TEXT,  -- JSONæ•°ç»„

    -- å¤´å›´æ•°æ® (PRD F-01)
    head_circumference  VARCHAR(20),
    head_notes          TEXT,  -- å¤´å›´å¤‡æ³¨

    -- æ¯›å¯æ¥æº (PRD F-03 æ–°å¢)
    wig_source          VARCHAR(20) DEFAULT 'client_sends',
                        -- client_sends: å®¢æˆ·å¯„æ¥
                        -- stylist_buys: æ¯›å¨˜ä»£è´­

    -- å·¥æœŸ
    expected_deadline   DATE,
    budget_range        VARCHAR(50),

    -- ç‰¹æ®Šè¦æ±‚
    special_requirements TEXT,  -- å‘é™…çº¿/ç‚¸æ¯›/é¬“è§’ç­‰

    -- çŠ¶æ€
    status              VARCHAR(20) DEFAULT 'new',
                        -- new: æ–°è¯¢ä»·
                        -- quoted: å·²æŠ¥ä»·
                        -- converted: å·²è½¬è®¢å•
                        -- rejected: å·²æ‹’ç»

    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_inquiries_user_id ON inquiries(user_id);
CREATE INDEX idx_inquiries_status ON inquiries(status);
```

#### 3.2.4 orders è¡¨ (è®¢å•) - **PRD 2.0 æ ¸å¿ƒå‡çº§**

```sql
CREATE TABLE orders (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id             UUID NOT NULL REFERENCES users(id),
    inquiry_id          UUID REFERENCES inquiries(id),

    -- å®¢æˆ·ä¿¡æ¯
    customer_name       VARCHAR(50),
    customer_contact    VARCHAR(100),

    -- è§’è‰²ä¿¡æ¯
    character_name      VARCHAR(100) NOT NULL,
    source_work         VARCHAR(100),
    reference_images    TEXT,  -- JSONæ•°ç»„

    -- å¤´å›´æ•°æ®
    head_circumference  VARCHAR(20),
    head_notes          TEXT,

    -- æ¯›å¯ç®¡ç† (PRD F-03 æ ¸å¿ƒæ–°å¢)
    wig_source          VARCHAR(20) DEFAULT 'client_sends',
    wig_tracking_no     VARCHAR(50),      -- æ¯›å¯å¿«é€’å•å·
    wig_received_at     TIMESTAMP,        -- æ¯›å¯ç¡®è®¤æ”¶è´§æ—¶é—´
    wig_purchase_fee    DECIMAL(10,2),    -- ä»£è´­è´¹ç”¨(å¦‚æ¯›å¨˜ä»£è´­)

    -- ä»·æ ¼ä¿¡æ¯ (PRD F-02)
    price               DECIMAL(10,2),    -- æ€»ä»·
    deposit             DECIMAL(10,2),    -- å®šé‡‘ (é»˜è®¤æ€»ä»·20%)
    balance             DECIMAL(10,2),    -- å°¾æ¬¾ (é»˜è®¤æ€»ä»·80%)
    deposit_paid_at     TIMESTAMP,        -- å®šé‡‘æ”¯ä»˜æ—¶é—´
    deposit_screenshot  TEXT,             -- å®šé‡‘æ”¯ä»˜æˆªå›¾
    balance_paid_at     TIMESTAMP,        -- å°¾æ¬¾æ”¯ä»˜æ—¶é—´
    balance_screenshot  TEXT,             -- å°¾æ¬¾æ”¯ä»˜æˆªå›¾

    -- å·¥æœŸç®¡ç† (PRD B-02)
    deadline            DATE,             -- äº¤ä»˜æˆªæ­¢æ—¥

    -- å‘è´§ä¿¡æ¯
    shipping_no         VARCHAR(50),      -- å‘è´§å¿«é€’å•å·
    shipping_company    VARCHAR(50),      -- å¿«é€’å…¬å¸
    shipped_at          TIMESTAMP,        -- å‘è´§æ—¶é—´

    -- å‘è´§æ¸…å• (PRD S-01)
    shipping_checklist  TEXT,             -- JSON: {balance_confirmed, cushioned, insured}

    -- åˆ¶ä½œç¬”è®° (PRD B-03)
    production_notes    TEXT,

    -- è®¢å•çŠ¶æ€ (PRD 2.0 ä¹çŠ¶æ€)
    status              VARCHAR(30) DEFAULT 'pending_quote',
                        -- pending_quote:     å¾…æŠ¥ä»·
                        -- pending_deposit:   å¾…ä»˜å®šé‡‘
                        -- awaiting_wig_base: ç­‰æ¯›å¯ (æ ¸å¿ƒæ–°å¢)
                        -- queued:            æ’å•ä¸­
                        -- in_progress:       åˆ¶ä½œä¸­
                        -- in_review:         éªŒæ”¶ä¸­ (æ ¸å¿ƒæ–°å¢)
                        -- pending_balance:   å¾…å°¾æ¬¾
                        -- shipped:           å·²å‘è´§
                        -- completed:         å·²å®Œæˆ

    -- å¤‡æ³¨
    notes               TEXT,  -- JSONæ•°ç»„

    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_deadline ON orders(deadline);
```

#### 3.2.5 reviews è¡¨ (éªŒæ”¶è®°å½•) - **PRD R-01 æ–°å¢**

```sql
CREATE TABLE reviews (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id            UUID NOT NULL REFERENCES orders(id),

    -- éªŒæ”¶å†…å®¹
    images              TEXT NOT NULL,    -- JSONæ•°ç»„: æˆå“å›¾ç‰‡
    description         TEXT,             -- æˆå“æè¿°

    -- éªŒæ”¶é“¾æ¥
    review_token        VARCHAR(100) UNIQUE,  -- å”¯ä¸€éªŒæ”¶é“¾æ¥token
    review_url          TEXT,             -- å®Œæ•´éªŒæ”¶é“¾æ¥

    -- éªŒæ”¶ç»“æœ
    is_approved         BOOLEAN,          -- æ˜¯å¦é€šè¿‡éªŒæ”¶
    approved_at         TIMESTAMP,        -- éªŒæ”¶é€šè¿‡æ—¶é—´

    -- ä¿®æ”¹æ¬¡æ•°é™åˆ¶ (PRD R-01)
    max_revisions       SMALLINT DEFAULT 2,
    revision_count      SMALLINT DEFAULT 0,

    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_reviews_order_id ON reviews(order_id);
CREATE INDEX idx_reviews_token ON reviews(review_token);
```

#### 3.2.6 review_revisions è¡¨ (ä¿®æ”¹è®°å½•) - **PRD R-02 æ–°å¢**

```sql
CREATE TABLE review_revisions (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    review_id           UUID NOT NULL REFERENCES reviews(id),

    -- ä¿®æ”¹è¯·æ±‚
    revision_number     SMALLINT NOT NULL,      -- ç¬¬å‡ æ¬¡ä¿®æ”¹
    request_content     TEXT NOT NULL,          -- ä¿®æ”¹æ„è§
    request_images      TEXT,                   -- å‚è€ƒå›¾ç‰‡
    requested_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- ä¿®æ”¹å®Œæˆ
    response_images     TEXT,                   -- ä¿®æ”¹åå›¾ç‰‡
    response_notes      TEXT,                   -- ä¿®æ”¹è¯´æ˜
    completed_at        TIMESTAMP,

    -- å®¢æˆ·ç¡®è®¤
    is_satisfied        BOOLEAN,                -- æ˜¯å¦æ»¡æ„
    confirmed_at        TIMESTAMP
);

CREATE INDEX idx_revisions_review_id ON review_revisions(review_id);
```

#### 3.2.7 sms_codes è¡¨ (éªŒè¯ç )

```sql
CREATE TABLE sms_codes (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    phone           VARCHAR(20) NOT NULL,
    code            VARCHAR(10) NOT NULL,
    expires_at      TIMESTAMP NOT NULL,
    used            BOOLEAN DEFAULT FALSE,
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_sms_codes_phone ON sms_codes(phone);
```

### 3.3 è®¢å•çŠ¶æ€æµè½¬å›¾

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   æ–°è¯¢ä»· (NEW)    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ æ¯›å¨˜æ¥å•
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å¾…æŠ¥ä»·           â”‚
                              â”‚ PENDING_QUOTE    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ æäº¤æŠ¥ä»·
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å¾…ä»˜å®šé‡‘         â”‚
                              â”‚ PENDING_DEPOSIT  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ å®šé‡‘åˆ°è´¦
                                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                                  â”‚
              â–¼                                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç­‰æ¯›å¯ (å®¢æˆ·å¯„)   â”‚                              â”‚ æ’å•ä¸­ (æ¯›å¨˜ä»£è´­) â”‚
    â”‚ AWAITING_WIG_BASEâ”‚                              â”‚ QUEUED           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ ç¡®è®¤æ”¶åˆ°æ¯›å¯                                     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ æ’å•ä¸­           â”‚
                           â”‚ QUEUED           â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ å¼€å§‹åˆ¶ä½œ
                                    â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ åˆ¶ä½œä¸­           â”‚
                           â”‚ IN_PROGRESS      â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ ä¸Šä¼ æˆå“å›¾
                                    â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ éªŒæ”¶ä¸­           â”‚â—„â”€â”€â”€â”€â”€â”
                           â”‚ IN_REVIEW        â”‚      â”‚ ç”³è¯·ä¿®æ”¹
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ (æ¬¡æ•°â‰¤2)
                                    â”‚                â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                       â”‚                         â”‚   â”‚
                       â–¼                         â–¼â”€â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å¾…å°¾æ¬¾         â”‚      â”‚ ä¿®æ”¹ä¸­         â”‚
              â”‚ PENDING_BALANCEâ”‚      â”‚ (IN_REVIEW)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ å°¾æ¬¾åˆ°è´¦
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å·²å‘è´§           â”‚
              â”‚ SHIPPED          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ å®¢æˆ·ç¡®è®¤æ”¶è´§
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ å·²å®Œæˆ           â”‚
              â”‚ COMPLETED        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. API æ¥å£è®¾è®¡

### 4.1 æ¥å£è§„èŒƒ

**Base URL**: `/api/v1`

**è¯·æ±‚æ ¼å¼**: JSON
**å“åº”æ ¼å¼**:
```json
{
  "code": 0,           // 0=æˆåŠŸ, é0=é”™è¯¯ç 
  "message": "success",
  "data": {}           // ä¸šåŠ¡æ•°æ®
}
```

**è®¤è¯æ–¹å¼**: Bearer Token (JWT)
```
Authorization: Bearer <token>
```

### 4.2 è®¤è¯æ¨¡å— `/api/v1/auth`

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | /send-code | å‘é€éªŒè¯ç  | å¦ |
| POST | /login | éªŒè¯ç ç™»å½• | å¦ |
| GET | /me | è·å–å½“å‰ç”¨æˆ· | æ˜¯ |

#### POST /send-code
```json
// Request
{ "phone": "13800138000" }

// Response
{ "code": 0, "message": "éªŒè¯ç å·²å‘é€" }
```

#### POST /login
```json
// Request
{ "phone": "13800138000", "code": "123456" }

// Response
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": { "id": "...", "phone": "...", "nickname": "..." }
  }
}
```

### 4.3 ç”¨æˆ·æ¨¡å— `/api/v1/users`

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /profile | è·å–ä¸ªäººèµ„æ–™ | æ˜¯ |
| PUT | /profile | æ›´æ–°ä¸ªäººèµ„æ–™ | æ˜¯ |
| GET | /public/:slug | è·å–å…¬å¼€ä¸»é¡µ | å¦ |

### 4.4 ä½œå“æ¨¡å— `/api/v1/works`

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | / | è·å–ä½œå“åˆ—è¡¨ | æ˜¯ |
| POST | / | æ·»åŠ ä½œå“ | æ˜¯ |
| PUT | /:id | æ›´æ–°ä½œå“ | æ˜¯ |
| DELETE | /:id | åˆ é™¤ä½œå“ | æ˜¯ |
| PUT | /sort | æ‰¹é‡æ’åº | æ˜¯ |

### 4.5 è¯¢ä»·æ¨¡å— `/api/v1/inquiries`

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | / | å®¢æˆ·æäº¤è¯¢ä»· | å¦ |
| GET | / | è·å–è¯¢ä»·åˆ—è¡¨ | æ˜¯ |
| GET | /:id | è·å–è¯¢ä»·è¯¦æƒ… | æ˜¯ |
| POST | /:id/quote | æäº¤æŠ¥ä»· | æ˜¯ |
| POST | /:id/convert | è½¬ä¸ºè®¢å• | æ˜¯ |
| PUT | /:id/reject | æ‹’ç»è¯¢ä»· | æ˜¯ |

#### POST / (å®¢æˆ·æäº¤è¯¢ä»·) - PRD F-01 ç»“æ„åŒ–è¡¨å•
```json
// Request
{
  "user_slug": "maoyi-xiaomei",
  "customer_name": "å°æ˜",
  "customer_contact": "wx: xiaoming123",
  "character_name": "åˆéŸ³æœªæ¥",
  "source_work": "VOCALOID",
  "expected_deadline": "2026-03-01",
  "head_circumference": "56cm",
  "head_notes": "å¤´å‹åæ‰ï¼Œåè„‘å‹ºå¹³",
  "wig_source": "client_sends",  // æ–°å¢: æ¯›å¯æ¥æº
  "special_requirements": "éœ€è¦åŒé©¬å°¾æ”¯æ’‘ï¼Œå‘é™…çº¿è‡ªç„¶è¿‡æ¸¡",
  "budget_range": "400-600",
  "reference_images": ["https://..."]
}
```

#### POST /:id/quote (æäº¤æŠ¥ä»·) - PRD F-02 è‡ªåŠ¨è®¡ç®—
```json
// Request
{
  "price": 500,
  "deadline": "2026-03-01",
  "notes": "å¤æ‚åŒé©¬å°¾éœ€è¦é¢å¤–å·¥æ—¶"
}

// Response (ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å®šé‡‘/å°¾æ¬¾)
{
  "code": 0,
  "data": {
    "price": 500,
    "deposit": 100,      // è‡ªåŠ¨è®¡ç®—: 500 * 20%
    "balance": 400,      // è‡ªåŠ¨è®¡ç®—: 500 * 80%
    "deadline": "2026-03-01"
  }
}
```

### 4.6 è®¢å•æ¨¡å— `/api/v1/orders` - **PRD 2.0 æ ¸å¿ƒå‡çº§**

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | / | è·å–è®¢å•åˆ—è¡¨ | æ˜¯ |
| GET | /:id | è·å–è®¢å•è¯¦æƒ… | æ˜¯ |
| PUT | /:id | æ›´æ–°è®¢å•ä¿¡æ¯ | æ˜¯ |
| PUT | /:id/status | æ›´æ–°è®¢å•çŠ¶æ€ | æ˜¯ |
| POST | /:id/notes | æ·»åŠ å¤‡æ³¨ | æ˜¯ |
| PUT | /:id/deposit | ç¡®è®¤å®šé‡‘ | æ˜¯ |
| PUT | /:id/wig-received | ç¡®è®¤æ¯›å¯æ”¶è´§ | æ˜¯ |
| PUT | /:id/balance | ç¡®è®¤å°¾æ¬¾ | æ˜¯ |
| PUT | /:id/ship | å‘è´§ | æ˜¯ |

#### GET / (è®¢å•åˆ—è¡¨ with ç»Ÿè®¡) - PRD B-01 çœ‹æ¿æ•°æ®
```json
// Response
{
  "code": 0,
  "data": {
    "list": [...],
    "pagination": { "page": 1, "limit": 20, "total": 50 },
    "statusCount": {
      "pending_quote": 2,
      "pending_deposit": 3,
      "awaiting_wig_base": 5,   // æ–°å¢
      "queued": 4,
      "in_progress": 8,
      "in_review": 2,           // æ–°å¢
      "pending_balance": 1,
      "shipped": 3,
      "completed": 22,
      "total": 50
    },
    "deadlineAlerts": [         // PRD B-02 æ­»çº¿é¢„è­¦
      { "id": "...", "character_name": "åˆéŸ³", "deadline": "2026-02-01", "daysLeft": 3, "level": "red" },
      { "id": "...", "character_name": "é­”æ³•å°‘å¥³", "deadline": "2026-02-05", "daysLeft": 7, "level": "yellow" }
    ]
  }
}
```

#### PUT /:id/deposit (ç¡®è®¤å®šé‡‘) - PRD æµç¨‹
```json
// Request
{
  "screenshot": "https://..."  // å®šé‡‘æ”¯ä»˜æˆªå›¾
}

// Response (æ ¹æ®wig_sourceå†³å®šä¸‹ä¸€çŠ¶æ€)
{
  "code": 0,
  "data": {
    "status": "awaiting_wig_base",  // å®¢æˆ·å¯„æ¯›å¯
    // æˆ–
    "status": "queued"              // æ¯›å¨˜ä»£è´­
  }
}
```

#### PUT /:id/wig-received (ç¡®è®¤æ¯›å¯æ”¶è´§) - PRD F-03 æ–°å¢
```json
// Request
{
  "tracking_no": "SF1234567890"  // å¯é€‰: å¿«é€’å•å·
}

// Response
{
  "code": 0,
  "data": {
    "status": "queued",
    "wig_received_at": "2026-01-20T10:30:00Z"
  }
}
```

#### PUT /:id/ship (å‘è´§) - PRD S-01 å‘è´§æ¸…å•
```json
// Request
{
  "shipping_company": "é¡ºä¸°",
  "shipping_no": "SF9876543210",
  "checklist": {
    "balance_confirmed": true,    // å·²ç¡®è®¤å°¾æ¬¾åˆ°è´¦
    "cushioned": true,            // å·²ä½¿ç”¨é˜²éœ‡åŒ…è£…
    "insured": false              // æ˜¯å¦ä¿ä»·
  }
}
```

### 4.7 éªŒæ”¶æ¨¡å— `/api/v1/reviews` - **PRD Rç³»åˆ— æ–°å¢**

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | / | åˆ›å»ºéªŒæ”¶(æ¯›å¨˜ä¸Šä¼ æˆå“) | æ˜¯ |
| GET | /:id | è·å–éªŒæ”¶è¯¦æƒ… | æ˜¯ |
| GET | /token/:token | å®¢æˆ·è®¿é—®éªŒæ”¶é¡µ | å¦ |
| POST | /:id/approve | å®¢æˆ·ç¡®è®¤æ»¡æ„ | å¦ |
| POST | /:id/revision | å®¢æˆ·ç”³è¯·ä¿®æ”¹ | å¦ |
| PUT | /:id/revision/:revisionId | æ¯›å¨˜æäº¤ä¿®æ”¹ | æ˜¯ |

#### POST / (åˆ›å»ºéªŒæ”¶) - PRD R-01
```json
// Request
{
  "order_id": "uuid...",
  "images": ["https://...", "https://..."],
  "description": "æˆå“å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹360åº¦å±•ç¤ºå›¾"
}

// Response
{
  "code": 0,
  "data": {
    "id": "review-uuid",
    "review_url": "https://yuefa.com/review/abc123xyz",  // å‘ç»™å®¢æˆ·çš„é“¾æ¥
    "max_revisions": 2
  }
}
```

#### GET /token/:token (å®¢æˆ·éªŒæ”¶é¡µ) - PRD R-01 éªŒæ”¶ä¸“ç”¨é¡µ
```json
// Response
{
  "code": 0,
  "data": {
    "order": {
      "character_name": "åˆéŸ³æœªæ¥",
      "source_work": "VOCALOID"
    },
    "images": ["https://...", "https://..."],
    "description": "...",
    "revision_count": 0,
    "max_revisions": 2,
    "is_approved": null,
    "revisions": []
  }
}
```

#### POST /:id/revision (ç”³è¯·ä¿®æ”¹) - PRD R-02
```json
// Request (é€šè¿‡tokenéªŒè¯èº«ä»½)
{
  "token": "abc123xyz",
  "request_content": "åˆ˜æµ·å¸Œæœ›å†å‰ªçŸ­ä¸€ç‚¹",
  "request_images": ["https://..."]  // å‚è€ƒå›¾
}

// Response
{
  "code": 0,
  "data": {
    "revision_number": 1,
    "remaining_revisions": 1
  }
}
```

### 4.8 ä¸Šä¼ æ¨¡å— `/api/v1/upload`

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | /image | ä¸Šä¼ å›¾ç‰‡ | å¦* |

*å®¢æˆ·ç«¯ä¸Šä¼ äººè®¾å›¾ä¸éœ€è¦è®¤è¯ï¼Œæ¯›å¨˜ä¸Šä¼ éœ€è¦è®¤è¯

### 4.9 æŠ¥å‘Šå¯¼å‡ºæ¨¡å— `/api/v1/reports` - **PRD S-02 æœªæ¥**

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /order/:id/pdf | å¯¼å‡ºè®¢å•PDFå‡­è¯ | æ˜¯ |

---

## 5. å‰ç«¯é¡µé¢ä¸ç»„ä»¶è§„åˆ’

### 5.1 è·¯ç”±ç»“æ„

```
/                           # é‡å®šå‘åˆ° /login
/login                      # æ¯›å¨˜ç™»å½•é¡µ

# å®¢æˆ·ç«¯é¡µé¢ (æ— éœ€ç™»å½•)
/s/:slug                    # æ¯›å¨˜å…¬å¼€ä¸»é¡µ (ä½œå“+è¯¢ä»·è¡¨å•)
/review/:token              # éªŒæ”¶ä¸“ç”¨é¡µ (PRD R-01 æ–°å¢)

# æ¯›å¨˜ç®¡ç†ç«¯ (éœ€ç™»å½•)
/admin                      # é‡å®šå‘åˆ° /admin/orders
/admin/orders               # è®¢å•ç®¡ç† (çœ‹æ¿è§†å›¾)
/admin/orders/:id           # è®¢å•è¯¦æƒ…
/admin/orders/:id/review    # åˆ›å»ºéªŒæ”¶ (PRD R-01 æ–°å¢)
/admin/inquiries            # è¯¢ä»·ç®¡ç† (æ–°å¢ç‹¬ç«‹é¡µ)
/admin/works                # ä½œå“ç®¡ç†
/admin/profile              # ä¸ªäººèµ„æ–™
```

### 5.2 é¡µé¢è®¾è®¡

#### 5.2.1 å®¢æˆ·å…¬å¼€ä¸»é¡µ `/s/:slug`

**åŠŸèƒ½**: PRD F-01 ç»“æ„åŒ–éœ€æ±‚è¡¨å•
- ä½œå“é›†å±•ç¤º
- è¯¢ä»·è¡¨å• (å¢å¼ºç‰ˆ)
  - è§’è‰²/ä½œå“
  - æœŸæœ›å·¥æœŸ (æ—¥å†é€‰æ‹©)
  - å¤´å›´æ•°æ® + æµ‹é‡ç¤ºæ„å›¾
  - **æ¯›å¯æ¥æºé€‰æ‹©** (æ–°å¢)
  - ç‰¹æ®Šè¦æ±‚ (å‘é™…çº¿/ç‚¸æ¯›/é¬“è§’)
  - é¢„ç®—èŒƒå›´
  - äººè®¾å›¾ä¸Šä¼ 

#### 5.2.2 éªŒæ”¶ä¸“ç”¨é¡µ `/review/:token` - **PRD R-01 æ–°å¢**

**åŠŸèƒ½**: æ•°å­—åŒ–éªŒæ”¶é—­ç¯
- å¹²å‡€ç®€æ´çš„èƒŒæ™¯
- æˆå“å›¾ç‰‡å±•ç¤º (æ”¯æŒæ”¾å¤§æŸ¥çœ‹)
- è®¢å•ä¿¡æ¯æ‘˜è¦
- ä¸¤ä¸ªå¤§æŒ‰é’®:
  - âœ… ç¡®è®¤æ»¡æ„ï¼Œå»ä»˜å°¾æ¬¾
  - ğŸ›  ç”³è¯·ä¿®æ”¹ (å‰©ä½™æ¬¡æ•°: N)
- ä¿®æ”¹è®°å½•å†å²

#### 5.2.3 è®¢å•ç®¡ç†çœ‹æ¿ `/admin/orders` - **PRD B-01 å‡çº§**

**åŠŸèƒ½**: å¯è§†åŒ–çŠ¶æ€æµè½¬çœ‹æ¿
- çŠ¶æ€ç­›é€‰æ  (9ä¸ªçŠ¶æ€)
- æ–°è¯¢ä»·é€šçŸ¥
- **æ­»çº¿é¢„è­¦** (PRD B-02)
  - 7å¤©å†…: é»„è‰²æé†’
  - 3å¤©å†…: çº¢è‰²æŠ¥è­¦
- è®¢å•å¡ç‰‡
  - æ¯›å¯çŠ¶æ€å›¾æ ‡ ğŸ“¦ (PRD UI/UX)
  - å¿«é€ŸçŠ¶æ€æ“ä½œ
- ä¸‹æ‹‰åˆ·æ–° + æ— é™åŠ è½½

#### 5.2.4 è®¢å•è¯¦æƒ… `/admin/orders/:id` - **PRD B-03 å‡çº§**

**åŠŸèƒ½**: å·¥å•è¯¦æƒ…é¡µ
- å®¢æˆ·ä¿¡æ¯
- è§’è‰²ä¿¡æ¯ + äººè®¾å›¾
- å¤´å›´æ•°æ®
- **æ¯›å¯çŠ¶æ€è¿½è¸ª** (æ–°å¢)
  - å¿«é€’å•å·
  - æ”¶è´§ç¡®è®¤
- ä»·æ ¼ä¿¡æ¯
  - æ€»ä»·/å®šé‡‘/å°¾æ¬¾
  - æ”¯ä»˜æˆªå›¾
- **åˆ¶ä½œç¬”è®°** (æ–°å¢)
- çŠ¶æ€æ“ä½œæŒ‰é’®
- éªŒæ”¶å…¥å£

### 5.3 ç»„ä»¶è§„åˆ’

#### 5.3.1 æ–°å¢ç»„ä»¶

| ç»„ä»¶å | è·¯å¾„ | åŠŸèƒ½ |
|--------|------|------|
| WigSourceSelector | components/WigSourceSelector.vue | æ¯›å¯æ¥æºé€‰æ‹©å™¨ |
| HeadMeasureGuide | components/HeadMeasureGuide.vue | å¤´å›´æµ‹é‡ç¤ºæ„å›¾ |
| DeadlineAlert | components/DeadlineAlert.vue | æ­»çº¿é¢„è­¦ç»„ä»¶ |
| WigTrackingCard | components/WigTrackingCard.vue | æ¯›å¯ç‰©æµè¿½è¸ªå¡ç‰‡ |
| ReviewCreator | components/ReviewCreator.vue | éªŒæ”¶åˆ›å»ºç»„ä»¶ |
| ReviewViewer | components/ReviewViewer.vue | éªŒæ”¶æŸ¥çœ‹ç»„ä»¶ |
| RevisionHistory | components/RevisionHistory.vue | ä¿®æ”¹è®°å½•å†å² |
| ShippingChecklist | components/ShippingChecklist.vue | å‘è´§æ¸…å•ç»„ä»¶ |
| StatusKanban | components/StatusKanban.vue | çŠ¶æ€çœ‹æ¿ç»„ä»¶ |

#### 5.3.2 ç°æœ‰ç»„ä»¶å‡çº§

| ç»„ä»¶å | å‡çº§å†…å®¹ |
|--------|----------|
| InquiryForm | æ·»åŠ æ¯›å¯æ¥æºã€å¤´å›´å¤‡æ³¨ã€ç‰¹æ®Šè¦æ±‚å­—æ®µ |
| OrderCard | æ·»åŠ æ¯›å¯çŠ¶æ€å›¾æ ‡ã€æ­»çº¿é¢„è­¦æ ‡è¯† |
| AdminTabbar | æ·»åŠ è¯¢ä»·Tab |

### 5.4 çŠ¶æ€ç®¡ç†

```javascript
// stores/orders.js
export const useOrderStore = defineStore('orders', {
  state: () => ({
    orders: [],
    statusCount: {},
    deadlineAlerts: [],  // æ–°å¢
    currentOrder: null
  }),

  actions: {
    // è·å–æ­»çº¿é¢„è­¦è®¢å•
    async fetchDeadlineAlerts() { ... },

    // ç¡®è®¤æ¯›å¯æ”¶è´§
    async confirmWigReceived(orderId, trackingNo) { ... },

    // åˆ›å»ºéªŒæ”¶
    async createReview(orderId, data) { ... }
  }
})

// stores/reviews.js (æ–°å¢)
export const useReviewStore = defineStore('reviews', {
  state: () => ({
    currentReview: null,
    revisions: []
  }),

  actions: {
    async fetchByToken(token) { ... },
    async approve(reviewId, token) { ... },
    async requestRevision(reviewId, data) { ... }
  }
})
```

---

## 6. å¼€å‘ä¼˜å…ˆçº§ä¸é‡Œç¨‹ç¢‘

### 6.1 P0 - MVPæ ¸å¿ƒ (å¿…é¡»æœ‰)

#### Phase 1: è¯¢ä»·è¡¨å•å‡çº§
- [ ] è¯¢ä»·è¡¨å•æ·»åŠ æ¯›å¯æ¥æºé€‰æ‹©
- [ ] è¯¢ä»·è¡¨å•æ·»åŠ å¤´å›´å¤‡æ³¨å­—æ®µ
- [ ] è¯¢ä»·è¡¨å•æ·»åŠ ç‰¹æ®Šè¦æ±‚å­—æ®µ
- [ ] å¤´å›´æµ‹é‡ç¤ºæ„å›¾ç»„ä»¶

#### Phase 2: è®¢å•çŠ¶æ€æ‰©å±•
- [ ] æ•°æ®åº“è¿ç§»: ordersè¡¨æ–°å¢å­—æ®µ
- [ ] åç«¯: 9ä¸ªçŠ¶æ€çš„æµè½¬é€»è¾‘
- [ ] å‰ç«¯: çŠ¶æ€ç­›é€‰æ æ›´æ–°
- [ ] å‰ç«¯: è®¢å•å¡ç‰‡çŠ¶æ€æ˜¾ç¤º

#### Phase 3: æ¯›å¯ç®¡ç†
- [ ] åç«¯: æ¯›å¯æ”¶è´§ç¡®è®¤API
- [ ] å‰ç«¯: æ¯›å¯çŠ¶æ€è¿½è¸ªå¡ç‰‡
- [ ] å‰ç«¯: è®¢å•å¡ç‰‡æ¯›å¯å›¾æ ‡

#### Phase 4: ç®€æ˜“éªŒæ”¶
- [ ] æ•°æ®åº“: reviewsè¡¨
- [ ] åç«¯: åˆ›å»ºéªŒæ”¶API
- [ ] åç«¯: éªŒæ”¶é“¾æ¥ç”Ÿæˆ
- [ ] å‰ç«¯: éªŒæ”¶åˆ›å»ºé¡µ
- [ ] å‰ç«¯: éªŒæ”¶ä¸“ç”¨é¡µ (å®¢æˆ·ç«¯)
- [ ] å‰ç«¯: ç¡®è®¤æ»¡æ„æŒ‰é’® (æ‰‹åŠ¨æ”¹çŠ¶æ€)

### 6.2 P1 - å¢å¼ºåŠŸèƒ½ (ä¸‹ä¸€æ­¥)

#### éªŒæ”¶äº¤äº’å®Œå–„
- [ ] éªŒæ”¶é¡µç¡®è®¤/ä¿®æ”¹æŒ‰é’®äº¤äº’
- [ ] ä¿®æ”¹è®°å½•åŠŸèƒ½
- [ ] ä¿®æ”¹æ¬¡æ•°é™åˆ¶
- [ ] çŠ¶æ€è‡ªåŠ¨æµè½¬

#### è‡ªåŠ¨è®¡ç®—
- [ ] æŠ¥ä»·æ—¶è‡ªåŠ¨è®¡ç®—20%/80%é‡‘é¢
- [ ] ä»·æ ¼ç¼–è¾‘æ—¶è‡ªåŠ¨æ›´æ–°

#### å‘è´§åŠŸèƒ½
- [ ] å‘è´§æ¸…å•Checklist
- [ ] å¿«é€’å•å·å½•å…¥
- [ ] å‘è´§çŠ¶æ€é€šçŸ¥

#### æ­»çº¿é¢„è­¦
- [ ] åç«¯: é¢„è­¦è®¡ç®—é€»è¾‘
- [ ] å‰ç«¯: é¢„è­¦ç»„ä»¶
- [ ] å‰ç«¯: é¢„è­¦æ ·å¼ (é»„/çº¢)

### 6.3 P2 - æœªæ¥è¿­ä»£

- [ ] PDFå‡­è¯å¯¼å‡º (ç»´æƒè¯æ®)
- [ ] ç‰©æµæ¥å£å¯¹æ¥ (è‡ªåŠ¨æŸ¥è¯¢å¿«é€’)
- [ ] è§†é¢‘éªŒæ”¶æ”¯æŒ
- [ ] æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ
- [ ] æ•°æ®ç»Ÿè®¡åˆ†æ

---

## 7. æµ‹è¯•æ–¹æ¡ˆ

### 7.1 å•å…ƒæµ‹è¯•

#### åç«¯æµ‹è¯• (Vitest + Supertest)

```javascript
// tests/orders.test.js
describe('Order Status Flow', () => {
  it('should transition from pending_deposit to awaiting_wig_base when wig_source is client_sends', async () => {
    // ...
  })

  it('should transition from pending_deposit to queued when wig_source is stylist_buys', async () => {
    // ...
  })

  it('should auto-calculate deposit and balance from price', async () => {
    // price: 500 => deposit: 100, balance: 400
  })
})

// tests/reviews.test.js
describe('Review Flow', () => {
  it('should create review and generate unique token', async () => {})
  it('should limit revisions to max_revisions', async () => {})
  it('should update order status to pending_balance on approval', async () => {})
})
```

#### å‰ç«¯æµ‹è¯• (Vitest + Vue Test Utils)

```javascript
// tests/InquiryForm.test.js
describe('InquiryForm', () => {
  it('should include wig_source field', () => {})
  it('should show head measure guide on icon click', () => {})
})

// tests/ReviewViewer.test.js
describe('ReviewViewer', () => {
  it('should show remaining revision count', () => {})
  it('should disable revision button when count is 0', () => {})
})
```

### 7.2 é›†æˆæµ‹è¯•

```javascript
// tests/integration/order-flow.test.js
describe('Complete Order Flow', () => {
  it('should complete full flow: inquiry -> order -> review -> ship -> complete', async () => {
    // 1. å®¢æˆ·æäº¤è¯¢ä»·
    // 2. æ¯›å¨˜æŠ¥ä»·
    // 3. è½¬ä¸ºè®¢å•
    // 4. ç¡®è®¤å®šé‡‘
    // 5. ç¡®è®¤æ¯›å¯æ”¶è´§ (if client_sends)
    // 6. å¼€å§‹åˆ¶ä½œ
    // 7. åˆ›å»ºéªŒæ”¶
    // 8. å®¢æˆ·ç¡®è®¤
    // 9. ç¡®è®¤å°¾æ¬¾
    // 10. å‘è´§
    // 11. å®Œæˆ
  })
})
```

### 7.3 E2Eæµ‹è¯• (Playwright)

```javascript
// e2e/customer-journey.spec.js
test('å®¢æˆ·å¯ä»¥æäº¤è¯¢ä»·å¹¶æŸ¥çœ‹éªŒæ”¶', async ({ page }) => {
  // è®¿é—®æ¯›å¨˜ä¸»é¡µ
  await page.goto('/s/maoyi-xiaomei')

  // å¡«å†™è¯¢ä»·è¡¨å•
  await page.fill('[name="character_name"]', 'åˆéŸ³æœªæ¥')
  await page.selectOption('[name="wig_source"]', 'client_sends')
  // ...

  // æäº¤
  await page.click('button[type="submit"]')

  // éªŒè¯æˆåŠŸ
  await expect(page.locator('.success-message')).toBeVisible()
})

// e2e/review-flow.spec.js
test('å®¢æˆ·å¯ä»¥åœ¨éªŒæ”¶é¡µç¡®è®¤æ»¡æ„æˆ–ç”³è¯·ä¿®æ”¹', async ({ page }) => {
  await page.goto('/review/abc123token')

  // æŸ¥çœ‹æˆå“å›¾
  await expect(page.locator('.review-images img')).toHaveCount(3)

  // ç”³è¯·ä¿®æ”¹
  await page.click('button:has-text("ç”³è¯·ä¿®æ”¹")')
  await page.fill('[name="request_content"]', 'åˆ˜æµ·å†çŸ­ä¸€ç‚¹')
  await page.click('button:has-text("æäº¤")')

  // éªŒè¯å‰©ä½™æ¬¡æ•°æ›´æ–°
  await expect(page.locator('.remaining-revisions')).toContainText('1')
})
```

---

## 8. éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 ç¯å¢ƒé…ç½®

#### å¼€å‘ç¯å¢ƒ (æœ¬åœ°)
```bash
# .env.development
NODE_ENV=development
DB_TYPE=sqlite
DB_PATH=./data/yuefa.db
JWT_SECRET=dev-secret
```

#### æµ‹è¯•ç¯å¢ƒ
```bash
# .env.test
NODE_ENV=test
DB_TYPE=sqlite
DB_PATH=:memory:
JWT_SECRET=test-secret
```

#### ç”Ÿäº§ç¯å¢ƒ
```bash
# .env.production
NODE_ENV=production
DB_TYPE=postgres
DATABASE_URL=postgresql://user:pass@host:5432/yuefa
JWT_SECRET=<strong-secret>
CORS_ORIGIN=https://yuefa.com
```

### 8.2 Dockeré…ç½®

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# å®‰è£…pnpm
RUN npm install -g pnpm

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/server/package.json ./packages/server/
COPY packages/web/package.json ./packages/web/

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºç 
COPY . .

# æ„å»º
RUN pnpm build

# æš´éœ²ç«¯å£
EXPOSE 4000

# å¯åŠ¨
CMD ["node", "packages/server/dist/index.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@db:5432/yuefa
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=yuefa
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./dist:/usr/share/nginx/html
    depends_on:
      - app
    restart: unless-stopped

volumes:
  postgres_data:
```

### 8.3 Nginxé…ç½®

```nginx
# nginx.conf
server {
    listen 80;
    server_name yuefa.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api {
        proxy_pass http://app:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads {
        alias /app/uploads;
    }
}
```

### 8.4 æ•°æ®åº“è¿ç§»

```javascript
// migrations/001_add_wig_fields.js
export async function up(db) {
  // æ·»åŠ æ¯›å¯ç›¸å…³å­—æ®µ
  await db.query(`
    ALTER TABLE orders
    ADD COLUMN wig_source VARCHAR(20) DEFAULT 'client_sends',
    ADD COLUMN wig_tracking_no VARCHAR(50),
    ADD COLUMN wig_received_at TIMESTAMP,
    ADD COLUMN wig_purchase_fee DECIMAL(10,2)
  `)

  // æ·»åŠ å°¾æ¬¾å­—æ®µ
  await db.query(`
    ALTER TABLE orders
    ADD COLUMN balance DECIMAL(10,2),
    ADD COLUMN balance_paid_at TIMESTAMP,
    ADD COLUMN balance_screenshot TEXT
  `)
}

export async function down(db) {
  // å›æ»š
  await db.query(`
    ALTER TABLE orders
    DROP COLUMN wig_source,
    DROP COLUMN wig_tracking_no,
    DROP COLUMN wig_received_at,
    DROP COLUMN wig_purchase_fee,
    DROP COLUMN balance,
    DROP COLUMN balance_paid_at,
    DROP COLUMN balance_screenshot
  `)
}
```

```javascript
// migrations/002_create_reviews.js
export async function up(db) {
  await db.query(`
    CREATE TABLE reviews (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      order_id UUID NOT NULL REFERENCES orders(id),
      images TEXT NOT NULL,
      description TEXT,
      review_token VARCHAR(100) UNIQUE,
      review_url TEXT,
      is_approved BOOLEAN,
      approved_at TIMESTAMP,
      max_revisions SMALLINT DEFAULT 2,
      revision_count SMALLINT DEFAULT 0,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
  `)

  await db.query(`
    CREATE TABLE review_revisions (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      review_id UUID NOT NULL REFERENCES reviews(id),
      revision_number SMALLINT NOT NULL,
      request_content TEXT NOT NULL,
      request_images TEXT,
      requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      response_images TEXT,
      response_notes TEXT,
      completed_at TIMESTAMP,
      is_satisfied BOOLEAN,
      confirmed_at TIMESTAMP
    )
  `)

  await db.query(`CREATE INDEX idx_reviews_order_id ON reviews(order_id)`)
  await db.query(`CREATE INDEX idx_reviews_token ON reviews(review_token)`)
  await db.query(`CREATE INDEX idx_revisions_review_id ON review_revisions(review_id)`)
}
```

---

## 9. é™„å½•

### 9.1 è®¢å•çŠ¶æ€ä¸­è‹±æ–‡å¯¹ç…§

| çŠ¶æ€å€¼ | ä¸­æ–‡ | è¯´æ˜ |
|--------|------|------|
| pending_quote | å¾…æŠ¥ä»· | è¯¢ä»·å·²æäº¤ï¼Œç­‰å¾…æ¯›å¨˜æŠ¥ä»· |
| pending_deposit | å¾…ä»˜å®šé‡‘ | å·²æŠ¥ä»·ï¼Œç­‰å¾…å®¢æˆ·ä»˜å®šé‡‘ |
| awaiting_wig_base | ç­‰æ¯›å¯ | å®šé‡‘å·²ä»˜ï¼Œç­‰å¾…å®¢æˆ·å¯„æ¯›å¯ |
| queued | æ’å•ä¸­ | æ¯›å¯å·²åˆ°/ä»£è´­ï¼Œç­‰å¾…å¼€å§‹åˆ¶ä½œ |
| in_progress | åˆ¶ä½œä¸­ | æ­£åœ¨åˆ¶ä½œ |
| in_review | éªŒæ”¶ä¸­ | å·²ä¸Šä¼ æˆå“ï¼Œç­‰å¾…å®¢æˆ·éªŒæ”¶ |
| pending_balance | å¾…å°¾æ¬¾ | éªŒæ”¶é€šè¿‡ï¼Œç­‰å¾…å®¢æˆ·ä»˜å°¾æ¬¾ |
| shipped | å·²å‘è´§ | å·²å‘è´§ï¼Œç­‰å¾…å®¢æˆ·ç¡®è®¤æ”¶è´§ |
| completed | å·²å®Œæˆ | äº¤æ˜“å®Œæˆ |

### 9.2 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 1001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 2001 | è®¤è¯å¤±è´¥ |
| 2002 | æ— æƒé™ |
| 3001 | èµ„æºä¸å­˜åœ¨ |
| 3002 | çŠ¶æ€æµè½¬é”™è¯¯ |
| 3003 | ä¿®æ”¹æ¬¡æ•°å·²ç”¨å®Œ |
| 4001 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### 9.3 æ–‡ä»¶ç›®å½•ç»“æ„ (è§„åˆ’)

```
codes/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ web/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ reviews.js          # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WigSourceSelector.vue   # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HeadMeasureGuide.vue    # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DeadlineAlert.vue       # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WigTrackingCard.vue     # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewCreator.vue       # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewViewer.vue        # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RevisionHistory.vue     # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ShippingChecklist.vue   # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PublicPage.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReviewPage.vue      # æ–°å¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Orders.vue          # å‡çº§
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ OrderDetail.vue     # å‡çº§
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ CreateReview.vue    # æ–°å¢
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚   â”‚       â”œâ”€â”€ reviews.js              # æ–°å¢
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ server/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ models/
â”‚       â”‚   â”‚   â”œâ”€â”€ Review.js               # æ–°å¢
â”‚       â”‚   â”‚   â”œâ”€â”€ ReviewRevision.js       # æ–°å¢
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ routes/
â”‚       â”‚   â”‚   â”œâ”€â”€ reviews.js              # æ–°å¢
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â””â”€â”€ migrations/                 # æ–°å¢
â”‚       â”‚       â”œâ”€â”€ 001_add_wig_fields.js
â”‚       â”‚       â””â”€â”€ 002_create_reviews.js
â”‚       â””â”€â”€ ...
â””â”€â”€ ...
```

---

**æ–‡æ¡£ç»“æŸ**

> æœ¬æ–‡æ¡£åŸºäº PRD 2.0 æµç¨‹æ·±åº¦æ•´åˆç‰ˆç¼–å†™ï¼Œè¯¦ç»†è§„åˆ’äº†çº¦å‘MVPçš„æŠ€æœ¯é€‰å‹ã€æ•°æ®åº“è®¾è®¡ã€APIæ¥å£ã€å‰ç«¯ç»„ä»¶å’Œå¼€å‘é‡Œç¨‹ç¢‘ã€‚å¼€å‘è¿‡ç¨‹ä¸­è¯·æŒç»­å‚è€ƒæœ¬æ–‡æ¡£ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚
